<mvc:View
    controllerName="amalisov.cuibono.controller.AddEditTranche"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.f"
    xmlns:layout="sap.ui.layout.form"
>
    <layout:SimpleForm
        class="table"
        editable="true"
        layout="ResponsiveGridLayout"
        labelSpanL="12"
        labelSpanM="12"
        labelSpanS="12"
        columnsL="2"
        columnsM="2"
        width="33%"
    >
        <layout:content>
            <VBox>
                <FlexBox
                    width="48%"
                    alignItems="Center"
                >
                    <Label text="{i18n>status}:" />
                    <Label
                        id="trancheStatus"
                        text="{trancheData>/status}"
                        class="customInputs"
                    />
                </FlexBox>
                <FlexBox
                    class="spaceAbove"
                    justifyContent="SpaceBetween"
                >
                    <VBox width="48%">
                        <Label text="{i18n>name}" />
                        <Input
                            id="trancheName"
                            value="{trancheData>/name}"
                            class="customInputs "
                            required="true"
                        />
                    </VBox>

                    <VBox width="48%">
                        <Label text="{i18n>location}" />
                        <ComboBox
                            id="trancheLocation"
                            items="{
                                    path: 'trancheModel>/Location'
                                }"
                            class="customInputs"
                            selectedKey="{trancheData>/Location_ID}"
                            required="true"
                        >
                            <core:Item
                                key="{trancheModel>ID}"
                                text="{trancheModel>name}"
                            />
                        </ComboBox>
                    </VBox>
                </FlexBox>

                <VBox class="spaceAbove">
                    <Label text="{i18n>description}" />
                    <TextArea
                        id="trancheDescription"
                        value="{trancheData>/description}"
                        rows="4"
                        class="customInput"
                    />
                </VBox>

                <FlexBox
                    class="spaceAbove"
                    justifyContent="SpaceBetween"
                >
                    <VBox width="48%">
                        <Label text="{i18n>startDate}" />
                        <DatePicker
                            id="beginDate"
                            value="{path:'trancheData>/beginDate',formatter:'.formatter.formatDate'}"
                            class="customInput"
                            required="true"
                        />
                    </VBox>
                    <VBox width="48%">
                        <Label text="{i18n>endDate}" />
                        <DatePicker
                            id="endDate"
                            value="{path:'trancheData>/endDate',formatter:'.formatter.formatDate'}"
                            class="customInput"
                            required="true"
                        />
                    </VBox>
                </FlexBox>

                <FlexBox
                    class="spaceAbove"
                    justifyContent="SpaceBetween"
                >
                    <VBox width="48%">
                        <Label text="{i18n>trancheWeight}" />
                        <Input
                            id="trancheWeight"
                            value="{trancheData>/trancheWeight}"
                            class="customInput"
                            required="true"
                        />
                    </VBox>
                    <VBox width="48%">
                        <Label text="{i18n>originDate}" />
                        <DatePicker
                            id="trancheOriginDate"
                            value="{path:'trancheData>/dateOfOrigin',formatter:'.formatter.formatDate'}"
                            class="customInput"
                            required="true"
                        />
                    </VBox>
                </FlexBox>
            </VBox>
        </layout:content>
    </layout:SimpleForm>

    <Table
        id="targetTable"
        items="{path: 'trancheData>/Target'}"
        width="33%"
    >
        <headerToolbar>
            <OverflowToolbar class="tableBar">
                <Title
                    text="{i18n>targetWeight}"
                    level="H2"
                />
                <ToolbarSpacer />
                <Button
                    type="Emphasized"
                    text="{i18n>addNewTarget}"
                    press="onAddTarget"
                />
            </OverflowToolbar>
        </headerToolbar>
        <columns>
            <Column hAlign="Begin">
                <Text text="{i18n>name}" />
            </Column>
            <Column hAlign="Begin">
                <Text text="{i18n>targetWeight}" />
            </Column>
            <Column hAlign="Begin">
                <Text text="{i18n>achievements}" />
            </Column>
            <Column>
                <Text text="" />
            </Column>
        </columns>
        <items>
            <ColumnListItem>
                <cells>
                    <Text text="{trancheData>name}" />
                    <Text
                        text="{ 
                        path: 'trancheData>weight', 
                        formatter: '.formatter.formatPercentage' }"
                    />
                    <Text
                        text="{ 
                        path: 'trancheData>achievement', 
                        formatter: '.formatter.formatPercentage' }"
                    />

                    <HBox class="trancheButtonBox">
                        <Button
                            type="Unstyled"
                            icon="sap-icon://edit"
                            press="onEditTargetPress"
                            class="editButton"
                        />

                        <Button
                            type="Unstyled"
                            icon="sap-icon://delete"
                            press="onDeleteTargetPress"
                            class="deleteButton"
                        />
                    </HBox>
                </cells>
            </ColumnListItem>
        </items>
    </Table>

    <FlexBox class="totalTrancheWeight sapUiLargeMarginBottom  ">
        <Title
            text="{i18n>total}"
            class="totalTitle"
        />
        <HBox class="totalBox">
            <core:Icon
                color="red"
                src="sap-icon://alert"
                visible="{path: 'trancheData>/totalWeight', formatter: '.formatter.formatIconVisibility'}"
                class="iconAlert"
            />

            <!-- Total Weight Text -->
            <Text
                text="{ 
                    path: 'trancheData>/totalWeight', 
                    formatter: '.formatter.formatPercentage' 
                }"
                class="{ 
                    path: 'trancheData>/totalWeight', 
                    formatter: '.formatter.formatTextClass'
                }"
            />
        </HBox>
    </FlexBox>
    <FlexBox
        class="customBtn1"
        width="99%"
        justifyContent="End"
    >
        <Button
            type="Emphasized"
            text="{i18n>save}"
            press="onSavePress"
            visible="{parts: [{path: 'trancheData>/status'}, {path: 'trancheData>/totalWeight'}], formatter: '.formatter.formatSaveVisibility'}"
        />

        <Button
            type="Ghost"
            text="{i18n>lock}"
            icon="sap-icon://locked"
            press=".onLockTranche"
            visible="{parts: [{path: 'trancheData>/status'}, {path: 'trancheData>/totalWeight'}], formatter: '.formatter.formatLockedVisibility'}"
        />
        <Button
            type="Accept"
            text="{i18n>completed}"
            icon="sap-icon://complete"
            press=".onCompleteTranche"
            visible="{parts: [{path: 'trancheData>/status'}, {path: 'trancheData>/totalWeight'}], formatter: '.formatter.formatCompleteVisibility'}"
        />
        <Button
            type="Ghost"
            text="{i18n>reopen}"
            icon="sap-icon://unlocked"
            press=".onReOpenTranche"
            visible="{parts: [{path: 'trancheData>/status'}, {path: 'trancheData>/totalWeight'}], formatter: '.formatter.formatCompleteVisibility'}"
        />
        <Button
            press=".onNavBack"
            type="Default"
            text="{i18n>discard}"
        />
    </FlexBox>
</mvc:View>
